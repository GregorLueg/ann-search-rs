## Quantised indices benchmarks and parameter gridsearch

Quantised indices compress the data stored in the index structure itself via
quantisation. This can also in some cases accelerated substantially the query
speed. The core idea is to trade in Recall for reduction in memory finger
print. If you wish to run on the examples, you can do so via:

```bash
cargo run --example gridsearch_sq8 --release --features quantised
```

If you wish to run all of the benchmarks, below, you can just run:

```bash
bash examples/run_benchmarks.sh --quantised
```

Similar to the other benchmarks, index building, query against 10% slightly
different data based on the trainings data and full kNN generation is being
benchmarked. Index size in memory is also provided.

## Table of Contents

- [BF16 quantisation](#bf16-ivf-and-exhaustive)
- [SQ8 quantisation](#sq8-ivf-and-exhaustive)
- [Product quantisation](#product-quantisation-ivf-only)
- [Optimised product quantisation](#optimised-product-quantisation-ivf-only)

### BF16 (IVF and exhaustive)

The BF16 quantisation reduces the floats to `bf16` which keeps the range of
`f32`, but loses precision in the digits from ~3 onwards. The actual distance
calculations in the index happen in `f32`; however, due to lossy compression
to `bf16` there is some Recall loss. This is compensated with drastically
reduced memory fingerprint (nearly halved for f32). The precision loss is
higher for Cosine over Euclidean distance.

**Key parameters:**

- *Number of lists (nl)*: The number of independent k-means cluster to generate.
  If the structure of the data is unknown, people use `sqrt(n)` as a heuristic.
- *Number of points (np)*: The number of clusters to probe during search.
  Numbers here tend to be `sqrt(nlist)` or up to 5% of the nlist.

<details>
<summary><b>BF16 quantisations - Euclidean (Gaussian)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 32D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                         3.14     1_466.17     1_469.31       1.0000     0.000000        18.31
Exhaustive (self)                                          3.14    14_688.74    14_691.88       1.0000     0.000000        18.31
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive-BF16 (query)                                    5.46     1_189.46     1_194.92       0.9867     0.065388         9.16
Exhaustive-BF16 (self)                                     5.46    15_217.56    15_223.02       1.0000     0.000000         9.16
--------------------------------------------------------------------------------------------------------------------------------
IVF-BF16-nl273-np13 (query)                              809.67       134.15       943.82       0.9771     0.096200        10.34
IVF-BF16-nl273-np16 (query)                              809.67       159.54       969.21       0.9840     0.070925        10.34
IVF-BF16-nl273-np23 (query)                              809.67       218.74     1_028.41       0.9867     0.065388        10.34
IVF-BF16-nl273 (self)                                    809.67     2_216.19     3_025.85       0.9830     0.094689        10.34
IVF-BF16-nl387-np19 (query)                            1_143.36       139.22     1_282.58       0.9805     0.093344        10.35
IVF-BF16-nl387-np27 (query)                            1_143.36       187.51     1_330.87       0.9865     0.065976        10.35
IVF-BF16-nl387 (self)                                  1_143.36     1_905.95     3_049.31       0.9828     0.095259        10.35
IVF-BF16-nl547-np23 (query)                            1_586.90       119.64     1_706.55       0.9767     0.102772        10.37
IVF-BF16-nl547-np27 (query)                            1_586.90       140.60     1_727.51       0.9833     0.078352        10.37
IVF-BF16-nl547-np33 (query)                            1_586.90       162.02     1_748.92       0.9865     0.066297        10.37
IVF-BF16-nl547 (self)                                  1_586.90     1_648.56     3_235.47       0.9827     0.095506        10.37
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

---

<details>
<summary><b>BF16 quantisations - Cosine (Gaussian)</b>:</summary>
</br>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 32D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                         4.35     1_519.06     1_523.40       1.0000     0.000000        18.88
Exhaustive (self)                                          4.35    15_957.53    15_961.88       1.0000     0.000000        18.88
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive-BF16 (query)                                    6.32     1_325.73     1_332.05       0.9240     0.000230         9.44
Exhaustive-BF16 (self)                                     6.32    15_892.71    15_899.03       1.0000     0.000000         9.44
--------------------------------------------------------------------------------------------------------------------------------
IVF-BF16-nl273-np13 (query)                              842.22       140.20       982.42       0.9176     0.000245        10.62
IVF-BF16-nl273-np16 (query)                              842.22       170.53     1_012.76       0.9224     0.000233        10.62
IVF-BF16-nl273-np23 (query)                              842.22       236.86     1_079.08       0.9240     0.000230        10.62
IVF-BF16-nl273 (self)                                    842.22     2_421.74     3_263.96       0.9229     0.001251        10.62
IVF-BF16-nl387-np19 (query)                            1_189.78       144.80     1_334.58       0.9198     0.000242        10.64
IVF-BF16-nl387-np27 (query)                            1_189.78       198.89     1_388.68       0.9239     0.000230        10.64
IVF-BF16-nl387 (self)                                  1_189.78     2_022.12     3_211.91       0.9228     0.001251        10.64
IVF-BF16-nl547-np23 (query)                            1_667.97       127.68     1_795.65       0.9177     0.000245        10.66
IVF-BF16-nl547-np27 (query)                            1_667.97       145.67     1_813.64       0.9219     0.000235        10.66
IVF-BF16-nl547-np33 (query)                            1_667.97       172.73     1_840.70       0.9238     0.000230        10.66
IVF-BF16-nl547 (self)                                  1_667.97     1_795.51     3_463.48       0.9228     0.001251        10.66
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

---

<details>
<summary><b>BF16 quantisations - Euclidean (Correlated)</b>:</summary>
</br>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 32D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                         3.09     1_499.29     1_502.38       1.0000     0.000000        18.31
Exhaustive (self)                                          3.09    16_277.11    16_280.21       1.0000     0.000000        18.31
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive-BF16 (query)                                    6.08     1_297.43     1_303.51       0.9649     0.019029         9.16
Exhaustive-BF16 (self)                                     6.08    15_647.79    15_653.87       1.0000     0.000000         9.16
--------------------------------------------------------------------------------------------------------------------------------
IVF-BF16-nl273-np13 (query)                              816.40       125.28       941.68       0.9648     0.019044        10.34
IVF-BF16-nl273-np16 (query)                              816.40       153.51       969.92       0.9649     0.019032        10.34
IVF-BF16-nl273-np23 (query)                              816.40       218.28     1_034.68       0.9649     0.019029        10.34
IVF-BF16-nl273 (self)                                    816.40     2_197.18     3_013.59       0.9561     0.026167        10.34
IVF-BF16-nl387-np19 (query)                            1_128.00       128.67     1_256.67       0.9649     0.019036        10.35
IVF-BF16-nl387-np27 (query)                            1_128.00       176.35     1_304.36       0.9649     0.019029        10.35
IVF-BF16-nl387 (self)                                  1_128.00     1_776.20     2_904.21       0.9561     0.026167        10.35
IVF-BF16-nl547-np23 (query)                            1_592.79       115.57     1_708.36       0.9649     0.019042        10.37
IVF-BF16-nl547-np27 (query)                            1_592.79       131.72     1_724.51       0.9649     0.019035        10.37
IVF-BF16-nl547-np33 (query)                            1_592.79       155.14     1_747.93       0.9649     0.019029        10.37
IVF-BF16-nl547 (self)                                  1_592.79     1_566.60     3_159.39       0.9561     0.026169        10.37
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

---

<details>
<summary><b>BF16 quantisations - Euclidean (LowRank)</b>:</summary>
</br>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 32D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                         3.17     1_491.84     1_495.01       1.0000     0.000000        18.31
Exhaustive (self)                                          3.17    16_004.95    16_008.13       1.0000     0.000000        18.31
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive-BF16 (query)                                    4.91     1_183.87     1_188.79       0.9348     0.158338         9.16
Exhaustive-BF16 (self)                                     4.91    15_293.71    15_298.62       1.0000     0.000000         9.16
--------------------------------------------------------------------------------------------------------------------------------
IVF-BF16-nl273-np13 (query)                              839.60       127.87       967.47       0.9348     0.158347        10.34
IVF-BF16-nl273-np16 (query)                              839.60       151.63       991.23       0.9348     0.158338        10.34
IVF-BF16-nl273-np23 (query)                              839.60       202.52     1_042.12       0.9348     0.158338        10.34
IVF-BF16-nl273 (self)                                    839.60     2_060.06     2_899.66       0.9174     0.221294        10.34
IVF-BF16-nl387-np19 (query)                            1_144.47       129.91     1_274.38       0.9348     0.158338        10.35
IVF-BF16-nl387-np27 (query)                            1_144.47       173.33     1_317.80       0.9348     0.158338        10.35
IVF-BF16-nl387 (self)                                  1_144.47     1_763.88     2_908.36       0.9174     0.221294        10.35
IVF-BF16-nl547-np23 (query)                            1_608.34       119.13     1_727.47       0.9348     0.158338        10.37
IVF-BF16-nl547-np27 (query)                            1_608.34       136.06     1_744.41       0.9348     0.158338        10.37
IVF-BF16-nl547-np33 (query)                            1_608.34       160.35     1_768.69       0.9348     0.158338        10.37
IVF-BF16-nl547 (self)                                  1_608.34     1_731.03     3_339.37       0.9174     0.221294        10.37
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

### SQ8 (IVF and exhaustive)

This index uses scalar quantisation to 8-bits. It projects every dimensions
onto an `i8`. This also causes a reduction of the memory finger print. In the
case of 96 dimensions in f32 per vector, we go from *96 x 32 bits = 384 bytes*
to *96 x 8 bits = 96 bytes per vector*, a **4x reduction in memory per vector**
(with overhead of the codebook). Additionally, the querying becomes much faster
due to integer math.

**Key parameters:**

- *Number of lists (nl)*: The number of independent k-means cluster to generate.
  If the structure of the data is unknown, people use `sqrt(n)` as a heuristic.
- *Number of points (np)*: The number of clusters to probe during search.
  Numbers here tend to be `sqrt(nlist)` or up to 5% of the nlist.

#### With 32 dimensions

The quantisation performs well on GaussianNoise data; however, the it loses
information for the correlated and also low rank data, indicating that complex
structure is lost during the lossy compression.

<details>
<summary><b>SQ8 quantisations - Euclidean (Gaussian)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 32D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                         3.09     1_564.24     1_567.33       1.0000     0.000000        18.31
Exhaustive (self)                                          3.09    17_367.36    17_370.45       1.0000     0.000000        18.31
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive-SQ8 (query)                                     7.27       758.78       766.05       0.8011          NaN         4.58
Exhaustive-SQ8 (self)                                      7.27     7_863.08     7_870.35       0.8007          NaN         4.58
--------------------------------------------------------------------------------------------------------------------------------
IVF-SQ8-nl273-np13 (query)                               925.86        59.22       985.08       0.7972          NaN         5.76
IVF-SQ8-nl273-np16 (query)                               925.86        66.88       992.74       0.8001          NaN         5.76
IVF-SQ8-nl273-np23 (query)                               925.86        92.28     1_018.14       0.8011          NaN         5.76
IVF-SQ8-nl273 (self)                                     925.86       912.20     1_838.07       0.8007          NaN         5.76
IVF-SQ8-nl387-np19 (query)                             1_227.42        64.32     1_291.74       0.7986          NaN         5.77
IVF-SQ8-nl387-np27 (query)                             1_227.42        79.79     1_307.21       0.8011          NaN         5.77
IVF-SQ8-nl387 (self)                                   1_227.42       737.41     1_964.83       0.8007          NaN         5.77
IVF-SQ8-nl547-np23 (query)                             1_687.83        56.47     1_744.30       0.7968          NaN         5.79
IVF-SQ8-nl547-np27 (query)                             1_687.83        73.60     1_761.43       0.7995          NaN         5.79
IVF-SQ8-nl547-np33 (query)                             1_687.83        72.61     1_760.45       0.8010          NaN         5.79
IVF-SQ8-nl547 (self)                                   1_687.83       720.97     2_408.80       0.8006          NaN         5.79
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

---

<details>
<summary><b>SQ8 quantisations - Cosine (Gaussian)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 32D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                         4.33     1_522.92     1_527.25       1.0000     0.000000        18.88
Exhaustive (self)                                          4.33    16_145.25    16_149.58       1.0000     0.000000        18.88
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive-SQ8 (query)                                    10.12       718.15       728.26       0.8501          NaN         5.15
Exhaustive-SQ8 (self)                                     10.12     7_479.45     7_489.56       0.8497          NaN         5.15
--------------------------------------------------------------------------------------------------------------------------------
IVF-SQ8-nl273-np13 (query)                             1_003.57        62.48     1_066.04       0.8455          NaN         6.33
IVF-SQ8-nl273-np16 (query)                             1_003.57        73.81     1_077.38       0.8488          NaN         6.33
IVF-SQ8-nl273-np23 (query)                             1_003.57       102.79     1_106.36       0.8501          NaN         6.33
IVF-SQ8-nl273 (self)                                   1_003.57     1_048.72     2_052.29       0.8497          NaN         6.33
IVF-SQ8-nl387-np19 (query)                             1_249.26        65.47     1_314.74       0.8472          NaN         6.34
IVF-SQ8-nl387-np27 (query)                             1_249.26        96.27     1_345.53       0.8500          NaN         6.34
IVF-SQ8-nl387 (self)                                   1_249.26       904.26     2_153.53       0.8497          NaN         6.34
IVF-SQ8-nl547-np23 (query)                             1_712.07        65.53     1_777.60       0.8456          NaN         6.37
IVF-SQ8-nl547-np27 (query)                             1_712.07        72.26     1_784.33       0.8486          NaN         6.37
IVF-SQ8-nl547-np33 (query)                             1_712.07        83.69     1_795.75       0.8500          NaN         6.37
IVF-SQ8-nl547 (self)                                   1_712.07       787.25     2_499.32       0.8496          NaN         6.37
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

---

<details>
<summary><b>SQ8 quantisations - Euclidean (Correlated)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 32D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                         3.07     1_573.82     1_576.89       1.0000     0.000000        18.31
Exhaustive (self)                                          3.07    16_483.63    16_486.70       1.0000     0.000000        18.31
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive-SQ8 (query)                                     6.97       756.11       763.08       0.6828          NaN         4.58
Exhaustive-SQ8 (self)                                      6.97     8_091.68     8_098.65       0.6835          NaN         4.58
--------------------------------------------------------------------------------------------------------------------------------
IVF-SQ8-nl273-np13 (query)                               908.38        67.40       975.78       0.6829          NaN         5.76
IVF-SQ8-nl273-np16 (query)                               908.38        75.59       983.97       0.6829          NaN         5.76
IVF-SQ8-nl273-np23 (query)                               908.38        92.14     1_000.52       0.6829          NaN         5.76
IVF-SQ8-nl273 (self)                                     908.38       898.96     1_807.34       0.6835          NaN         5.76
IVF-SQ8-nl387-np19 (query)                             1_360.89        60.16     1_421.05       0.6829          NaN         5.77
IVF-SQ8-nl387-np27 (query)                             1_360.89        82.01     1_442.91       0.6828          NaN         5.77
IVF-SQ8-nl387 (self)                                   1_360.89       749.15     2_110.04       0.6835          NaN         5.77
IVF-SQ8-nl547-np23 (query)                             1_694.63        55.93     1_750.56       0.6830          NaN         5.79
IVF-SQ8-nl547-np27 (query)                             1_694.63        62.69     1_757.32       0.6830          NaN         5.79
IVF-SQ8-nl547-np33 (query)                             1_694.63        71.06     1_765.69       0.6829          NaN         5.79
IVF-SQ8-nl547 (self)                                   1_694.63       688.57     2_383.20       0.6835          NaN         5.79
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

---

<details>
<summary><b>SQ8 quantisations - Euclidean (LowRank)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 32D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                         3.08     1_549.25     1_552.33       1.0000     0.000000        18.31
Exhaustive (self)                                          3.08    15_387.54    15_390.62       1.0000     0.000000        18.31
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive-SQ8 (query)                                     7.59       724.68       732.27       0.4800          NaN         4.58
Exhaustive-SQ8 (self)                                      7.59     7_880.97     7_888.56       0.4862          NaN         4.58
--------------------------------------------------------------------------------------------------------------------------------
IVF-SQ8-nl273-np13 (query)                               908.20        55.87       964.06       0.4802          NaN         5.76
IVF-SQ8-nl273-np16 (query)                               908.20        73.73       981.92       0.4801          NaN         5.76
IVF-SQ8-nl273-np23 (query)                               908.20        97.39     1_005.59       0.4801          NaN         5.76
IVF-SQ8-nl273 (self)                                     908.20       825.77     1_733.97       0.4864          NaN         5.76
IVF-SQ8-nl387-np19 (query)                             1_211.19        60.81     1_272.00       0.4802          NaN         5.77
IVF-SQ8-nl387-np27 (query)                             1_211.19        74.70     1_285.89       0.4801          NaN         5.77
IVF-SQ8-nl387 (self)                                   1_211.19       722.73     1_933.92       0.4864          NaN         5.77
IVF-SQ8-nl547-np23 (query)                             1_693.60        60.84     1_754.44       0.4802          NaN         5.79
IVF-SQ8-nl547-np27 (query)                             1_693.60        70.58     1_764.18       0.4801          NaN         5.79
IVF-SQ8-nl547-np33 (query)                             1_693.60        78.30     1_771.90       0.4801          NaN         5.79
IVF-SQ8-nl547 (self)                                   1_693.60       689.46     2_383.06       0.4864          NaN         5.79
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

#### With more dimensions (96 dimensions)

The compression and speed-ups become more and more pronounced with higher
dimensionality in the data.

<details>
<summary><b>SQ8 quantisations - Euclidean (Gaussian - more dimensions)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 96D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                        10.09     4_430.88     4_440.98       1.0000     0.000000        54.93
Exhaustive (self)                                         10.09    43_436.68    43_446.78       1.0000     0.000000        54.93
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive-SQ8 (query)                                    26.50     1_341.39     1_367.90       0.8382          NaN        13.73
Exhaustive-SQ8 (self)                                     26.50    13_740.73    13_767.24       0.8385          NaN        13.73
--------------------------------------------------------------------------------------------------------------------------------
IVF-SQ8-nl273-np13 (query)                             2_013.70       207.65     2_221.35       0.8232          NaN        14.98
IVF-SQ8-nl273-np16 (query)                             2_013.70       261.47     2_275.16       0.8339          NaN        14.98
IVF-SQ8-nl273-np23 (query)                             2_013.70       320.55     2_334.25       0.8382          NaN        14.98
IVF-SQ8-nl273 (self)                                   2_013.70     3_822.32     5_836.02       0.8385          NaN        14.98
IVF-SQ8-nl387-np19 (query)                             3_136.61       219.08     3_355.69       0.8283          NaN        15.02
IVF-SQ8-nl387-np27 (query)                             3_136.61       286.10     3_422.72       0.8382          NaN        15.02
IVF-SQ8-nl387 (self)                                   3_136.61     3_278.93     6_415.54       0.8385          NaN        15.02
IVF-SQ8-nl547-np23 (query)                             4_098.39       201.35     4_299.74       0.8230          NaN        15.08
IVF-SQ8-nl547-np27 (query)                             4_098.39       227.64     4_326.03       0.8318          NaN        15.08
IVF-SQ8-nl547-np33 (query)                             4_098.39       266.22     4_364.61       0.8370          NaN        15.08
IVF-SQ8-nl547 (self)                                   4_098.39     2_563.65     6_662.04       0.8372          NaN        15.08
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

---

<details>
<summary><b>SQ8 quantisations - Euclidean (Correlated - more dimensions)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 96D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                        11.69     4_406.77     4_418.46       1.0000     0.000000        54.93
Exhaustive (self)                                         11.69    43_048.84    43_060.53       1.0000     0.000000        54.93
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive-SQ8 (query)                                    29.30     1_319.54     1_348.84       0.6933          NaN        13.73
Exhaustive-SQ8 (self)                                     29.30    13_412.41    13_441.71       0.6932          NaN        13.73
--------------------------------------------------------------------------------------------------------------------------------
IVF-SQ8-nl273-np13 (query)                             1_972.46       197.70     2_170.16       0.6925          NaN        14.98
IVF-SQ8-nl273-np16 (query)                             1_972.46       233.53     2_205.99       0.6931          NaN        14.98
IVF-SQ8-nl273-np23 (query)                             1_972.46       316.86     2_289.31       0.6933          NaN        14.98
IVF-SQ8-nl273 (self)                                   1_972.46     3_112.53     5_084.99       0.6932          NaN        14.98
IVF-SQ8-nl387-np19 (query)                             2_822.26       211.24     3_033.50       0.6930          NaN        15.02
IVF-SQ8-nl387-np27 (query)                             2_822.26       280.55     3_102.81       0.6933          NaN        15.02
IVF-SQ8-nl387 (self)                                   2_822.26     2_787.93     5_610.19       0.6932          NaN        15.02
IVF-SQ8-nl547-np23 (query)                             3_989.15       207.68     4_196.84       0.6928          NaN        15.08
IVF-SQ8-nl547-np27 (query)                             3_989.15       229.99     4_219.14       0.6932          NaN        15.08
IVF-SQ8-nl547-np33 (query)                             3_989.15       268.32     4_257.47       0.6933          NaN        15.08
IVF-SQ8-nl547 (self)                                   3_989.15     2_565.20     6_554.36       0.6932          NaN        15.08
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

---

<details>
<summary><b>SQ8 quantisations - Euclidean (LowRank - more dimensions)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 96D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                        10.82     4_562.27     4_573.08       1.0000     0.000000        54.93
Exhaustive (self)                                         10.82    48_238.23    48_249.05       1.0000     0.000000        54.93
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive-SQ8 (query)                                    27.86     1_323.04     1_350.90       0.7793          NaN        13.73
Exhaustive-SQ8 (self)                                     27.86    13_446.15    13_474.01       0.7834          NaN        13.73
--------------------------------------------------------------------------------------------------------------------------------
IVF-SQ8-nl273-np13 (query)                             2_132.55       193.59     2_326.14       0.7794          NaN        14.98
IVF-SQ8-nl273-np16 (query)                             2_132.55       226.37     2_358.92       0.7794          NaN        14.98
IVF-SQ8-nl273-np23 (query)                             2_132.55       317.06     2_449.60       0.7794          NaN        14.98
IVF-SQ8-nl273 (self)                                   2_132.55     3_071.56     5_204.10       0.7835          NaN        14.98
IVF-SQ8-nl387-np19 (query)                             2_842.84       209.01     3_051.85       0.7794          NaN        15.02
IVF-SQ8-nl387-np27 (query)                             2_842.84       266.35     3_109.19       0.7793          NaN        15.02
IVF-SQ8-nl387 (self)                                   2_842.84     2_628.29     5_471.13       0.7835          NaN        15.02
IVF-SQ8-nl547-np23 (query)                             4_091.59       211.09     4_302.68       0.7794          NaN        15.08
IVF-SQ8-nl547-np27 (query)                             4_091.59       230.51     4_322.10       0.7793          NaN        15.08
IVF-SQ8-nl547-np33 (query)                             4_091.59       269.22     4_360.82       0.7794          NaN        15.08
IVF-SQ8-nl547 (self)                                   4_091.59     2_674.10     6_765.69       0.7835          NaN        15.08
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

#### With even more dimensions (128 dimensions)

<details>
<summary><b>SQ8 quantisations - Euclidean (Gaussian - even more dimensions)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 128D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                        15.09     7_129.44     7_144.53       1.0000     0.000000        73.24
Exhaustive (self)                                         15.09    67_381.40    67_396.50       1.0000     0.000000        73.24
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive-SQ8 (query)                                    42.60     1_634.24     1_676.84       0.8377          NaN        18.31
Exhaustive-SQ8 (self)                                     42.60    17_016.11    17_058.71       0.8374          NaN        18.31
--------------------------------------------------------------------------------------------------------------------------------
IVF-SQ8-nl273-np13 (query)                             2_828.93       278.07     3_107.00       0.8083          NaN        19.59
IVF-SQ8-nl273-np16 (query)                             2_828.93       330.37     3_159.30       0.8266          NaN        19.59
IVF-SQ8-nl273-np23 (query)                             2_828.93       442.18     3_271.11       0.8377          NaN        19.59
IVF-SQ8-nl273 (self)                                   2_828.93     4_430.47     7_259.40       0.8374          NaN        19.59
IVF-SQ8-nl387-np19 (query)                             4_020.16       304.93     4_325.09       0.8177          NaN        19.65
IVF-SQ8-nl387-np27 (query)                             4_020.16       399.38     4_419.53       0.8361          NaN        19.65
IVF-SQ8-nl387 (self)                                   4_020.16     4_003.63     8_023.79       0.8359          NaN        19.65
IVF-SQ8-nl547-np23 (query)                             5_616.37       301.06     5_917.44       0.8098          NaN        19.73
IVF-SQ8-nl547-np27 (query)                             5_616.37       333.31     5_949.68       0.8237          NaN        19.73
IVF-SQ8-nl547-np33 (query)                             5_616.37       396.36     6_012.73       0.8344          NaN        19.73
IVF-SQ8-nl547 (self)                                   5_616.37     3_950.69     9_567.07       0.8344          NaN        19.73
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

---

<details>
<summary><b>SQ8 quantisations - Euclidean (Correlated - even more dimensions)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 128D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                        14.89     6_170.86     6_185.75       1.0000     0.000000        73.24
Exhaustive (self)                                         14.89    62_021.96    62_036.85       1.0000     0.000000        73.24
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive-SQ8 (query)                                    41.10     1_656.90     1_698.00       0.6135          NaN        18.31
Exhaustive-SQ8 (self)                                     41.10    17_866.66    17_907.76       0.6146          NaN        18.31
--------------------------------------------------------------------------------------------------------------------------------
IVF-SQ8-nl273-np13 (query)                             3_020.61       335.94     3_356.55       0.6126          NaN        19.59
IVF-SQ8-nl273-np16 (query)                             3_020.61       385.03     3_405.64       0.6134          NaN        19.59
IVF-SQ8-nl273-np23 (query)                             3_020.61       543.19     3_563.80       0.6135          NaN        19.59
IVF-SQ8-nl273 (self)                                   3_020.61     4_940.57     7_961.18       0.6146          NaN        19.59
IVF-SQ8-nl387-np19 (query)                             4_183.36       314.28     4_497.65       0.6129          NaN        19.65
IVF-SQ8-nl387-np27 (query)                             4_183.36       410.18     4_593.54       0.6135          NaN        19.65
IVF-SQ8-nl387 (self)                                   4_183.36     4_396.43     8_579.79       0.6146          NaN        19.65
IVF-SQ8-nl547-np23 (query)                             5_926.05       307.04     6_233.09       0.6125          NaN        19.73
IVF-SQ8-nl547-np27 (query)                             5_926.05       370.45     6_296.50       0.6132          NaN        19.73
IVF-SQ8-nl547-np33 (query)                             5_926.05       390.75     6_316.80       0.6135          NaN        19.73
IVF-SQ8-nl547 (self)                                   5_926.05     3_914.04     9_840.09       0.6146          NaN        19.73
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

---

<details>
<summary><b>SQ8 quantisations - Euclidean (LowRank - even more dimensions)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 128D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                        14.74     6_093.62     6_108.37       1.0000     0.000000        73.24
Exhaustive (self)                                         14.74    62_108.66    62_123.41       1.0000     0.000000        73.24
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive-SQ8 (query)                                    47.29     1_660.68     1_707.97       0.8081          NaN        18.31
Exhaustive-SQ8 (self)                                     47.29    17_599.54    17_646.82       0.8095          NaN        18.31
--------------------------------------------------------------------------------------------------------------------------------
IVF-SQ8-nl273-np13 (query)                             2_933.88       280.06     3_213.94       0.8081          NaN        19.59
IVF-SQ8-nl273-np16 (query)                             2_933.88       326.41     3_260.29       0.8081          NaN        19.59
IVF-SQ8-nl273-np23 (query)                             2_933.88       423.81     3_357.69       0.8081          NaN        19.59
IVF-SQ8-nl273 (self)                                   2_933.88     4_291.08     7_224.96       0.8096          NaN        19.59
IVF-SQ8-nl387-np19 (query)                             4_203.42       347.51     4_550.93       0.8081          NaN        19.65
IVF-SQ8-nl387-np27 (query)                             4_203.42       428.10     4_631.52       0.8081          NaN        19.65
IVF-SQ8-nl387 (self)                                   4_203.42     4_074.70     8_278.12       0.8096          NaN        19.65
IVF-SQ8-nl547-np23 (query)                             5_719.09       302.95     6_022.04       0.8081          NaN        19.73
IVF-SQ8-nl547-np27 (query)                             5_719.09       332.32     6_051.41       0.8081          NaN        19.73
IVF-SQ8-nl547-np33 (query)                             5_719.09       444.52     6_163.61       0.8081          NaN        19.73
IVF-SQ8-nl547 (self)                                   5_719.09     4_039.26     9_758.35       0.8095          NaN        19.73
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

### Product quantisation (IVF only)

This index uses product quantisation. To note, the quantisation is quite harsh
and hence, reduces the Recall quite substantially. In the case of 192
dimensions, each vector gets reduced to
from *192 x 32 bits (192 x f32) = 768 bytes* to for
*m = 32 (32 sub vectors) to 32 x u8 = 32 bytes*, a
**24x reduction in memory usage** (of course with overhead from the cook book).
However, it can still be useful in situation where good enough works and you
have VERY large scale data.</br>
This version is run on a special version of the synthetic data that is less
affected by the curse of dimensionality! Also, there are some correlated
features in there that can be theoretically better exploited by optimised
product quantisation, see below.

**Key parameters:**

- *Number of lists (nl)*: The number of independent k-means cluster to generate.
  If the structure of the data is unknown, people use `sqrt(n)` as a heuristic.
- *Number of points (np)*: The number of clusters to probe during search.
  Numbers here tend to be `sqrt(nlist)` or up to 5% of the nlist.
- *Number of subvectors (m)*: In how many subvectors to divide the given main
  vector. The initial dimensionality needs to be divisable by m.

The self queries here run on the compressed indices stored in the structure
itself. We can appreciate that the lossy compression affects the recall here. If
you wish to get great kNN graphs from these indices, you need to re-supply the
non-compressed data (at cost of memory!). Similar to `SQ8`-indices, the
distances are difficult to interpret/compare against original vectors due to
the heavy quantisation, thus, are not reported. The self queries default
to `sqrt(nlist)`.

#### With 128 dimensions

Due to being optimised for high dimensional data, we start with 128 dimensions
here. One can appreciate that `m16` causes a high Recall loss as it compresses
the data too much and the more "structure" the data has (correlated features,
low rank manifolds), the better these indices perform. The PQ quantisation
however is a bit more expensive, hence, more time is being used on index
building. Querying on the other hand is very performant.

<details>
<summary><b>PQ quantisations - Euclidean (Gaussian - 128 dim)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 128D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                        14.95     7_012.56     7_027.51       1.0000     0.000000        73.24
Exhaustive (self)                                         14.95    65_878.93    65_893.89       1.0000     0.000000        73.24
--------------------------------------------------------------------------------------------------------------------------------
IVF-PQ-nl273-m16-np13 (query)                          9_053.86       500.95     9_554.81       0.2659          NaN         3.69
IVF-PQ-nl273-m16-np16 (query)                          9_053.86       613.22     9_667.08       0.2679          NaN         3.69
IVF-PQ-nl273-m16-np23 (query)                          9_053.86       853.30     9_907.16       0.2690          NaN         3.69
IVF-PQ-nl273-m16 (self)                                9_053.86     8_448.93    17_502.79       0.1804          NaN         3.69
IVF-PQ-nl273-m32-np13 (query)                         12_660.13       949.54    13_609.68       0.5110          NaN         5.98
IVF-PQ-nl273-m32-np16 (query)                         12_660.13     1_043.29    13_703.42       0.5187          NaN         5.98
IVF-PQ-nl273-m32-np23 (query)                         12_660.13     1_485.53    14_145.66       0.5233          NaN         5.98
IVF-PQ-nl273-m32 (self)                               12_660.13    14_846.95    27_507.09       0.4293          NaN         5.98
IVF-PQ-nl387-m16-np19 (query)                         10_282.39       655.23    10_937.61       0.2704          NaN         3.75
IVF-PQ-nl387-m16-np27 (query)                         10_282.39       898.13    11_180.51       0.2721          NaN         3.75
IVF-PQ-nl387-m16 (self)                               10_282.39     9_000.23    19_282.61       0.1822          NaN         3.75
IVF-PQ-nl387-m32-np19 (query)                         13_727.18     1_120.67    14_847.85       0.5152          NaN         6.04
IVF-PQ-nl387-m32-np27 (query)                         13_727.18     1_561.94    15_289.13       0.5230          NaN         6.04
IVF-PQ-nl387-m32 (self)                               13_727.18    15_635.95    29_363.13       0.4301          NaN         6.04
IVF-PQ-nl547-m16-np23 (query)                         12_368.02       765.53    13_133.54       0.2714          NaN         3.83
IVF-PQ-nl547-m16-np27 (query)                         12_368.02       891.89    13_259.91       0.2729          NaN         3.83
IVF-PQ-nl547-m16-np33 (query)                         12_368.02     1_081.21    13_449.22       0.2739          NaN         3.83
IVF-PQ-nl547-m16 (self)                               12_368.02    10_471.37    22_839.39       0.1834          NaN         3.83
IVF-PQ-nl547-m32-np23 (query)                         15_283.43     1_336.88    16_620.31       0.5100          NaN         6.12
IVF-PQ-nl547-m32-np27 (query)                         15_283.43     1_485.23    16_768.66       0.5157          NaN         6.12
IVF-PQ-nl547-m32-np33 (query)                         15_283.43     1_789.40    17_072.83       0.5203          NaN         6.12
IVF-PQ-nl547-m32 (self)                               15_283.43    18_311.48    33_594.91       0.4304          NaN         6.12
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

---

<details>
<summary><b>PQ quantisations - Euclidean (Correlated - 128 dim)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 128D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                        16.19     6_788.24     6_804.42       1.0000     0.000000        73.24
Exhaustive (self)                                         16.19    63_767.49    63_783.68       1.0000     0.000000        73.24
--------------------------------------------------------------------------------------------------------------------------------
IVF-PQ-nl273-m16-np13 (query)                          9_425.15       530.61     9_955.75       0.5572          NaN         3.69
IVF-PQ-nl273-m16-np16 (query)                          9_425.15       644.56    10_069.71       0.5578          NaN         3.69
IVF-PQ-nl273-m16-np23 (query)                          9_425.15     1_024.09    10_449.23       0.5580          NaN         3.69
IVF-PQ-nl273-m16 (self)                                9_425.15     8_972.56    18_397.71       0.4610          NaN         3.69
IVF-PQ-nl273-m32-np13 (query)                         12_527.45       879.31    13_406.76       0.7284          NaN         5.98
IVF-PQ-nl273-m32-np16 (query)                         12_527.45     1_082.47    13_609.92       0.7300          NaN         5.98
IVF-PQ-nl273-m32-np23 (query)                         12_527.45     1_589.83    14_117.28       0.7304          NaN         5.98
IVF-PQ-nl273-m32 (self)                               12_527.45    16_998.02    29_525.47       0.6614          NaN         5.98
IVF-PQ-nl387-m16-np19 (query)                         11_162.08       732.77    11_894.85       0.5580          NaN         3.75
IVF-PQ-nl387-m16-np27 (query)                         11_162.08       993.62    12_155.70       0.5585          NaN         3.75
IVF-PQ-nl387-m16 (self)                               11_162.08     9_649.97    20_812.05       0.4622          NaN         3.75
IVF-PQ-nl387-m32-np19 (query)                         13_701.21     1_120.65    14_821.86       0.7295          NaN         6.04
IVF-PQ-nl387-m32-np27 (query)                         13_701.21     1_578.96    15_280.17       0.7306          NaN         6.04
IVF-PQ-nl387-m32 (self)                               13_701.21    15_940.71    29_641.92       0.6632          NaN         6.04
IVF-PQ-nl547-m16-np23 (query)                         11_837.64       749.46    12_587.10       0.5609          NaN         3.83
IVF-PQ-nl547-m16-np27 (query)                         11_837.64       907.63    12_745.26       0.5612          NaN         3.83
IVF-PQ-nl547-m16-np33 (query)                         11_837.64     1_023.38    12_861.02       0.5615          NaN         3.83
IVF-PQ-nl547-m16 (self)                               11_837.64    10_551.44    22_389.07       0.4656          NaN         3.83
IVF-PQ-nl547-m32-np23 (query)                         15_461.21     1_343.33    16_804.54       0.7313          NaN         6.12
IVF-PQ-nl547-m32-np27 (query)                         15_461.21     1_662.47    17_123.68       0.7327          NaN         6.12
IVF-PQ-nl547-m32-np33 (query)                         15_461.21     2_038.16    17_499.37       0.7333          NaN         6.12
IVF-PQ-nl547-m32 (self)                               15_461.21    18_388.77    33_849.98       0.6651          NaN         6.12
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

---

<details>
<summary><b>PQ quantisations - Euclidean (Low Rank - 128 dim)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 128D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                        15.52     6_249.38     6_264.89       1.0000     0.000000        73.24
Exhaustive (self)                                         15.52    62_381.59    62_397.11       1.0000     0.000000        73.24
--------------------------------------------------------------------------------------------------------------------------------
IVF-PQ-nl273-m16-np13 (query)                          8_999.39       495.66     9_495.05       0.6977          NaN         3.69
IVF-PQ-nl273-m16-np16 (query)                          8_999.39       601.57     9_600.96       0.6977          NaN         3.69
IVF-PQ-nl273-m16-np23 (query)                          8_999.39       829.82     9_829.21       0.6977          NaN         3.69
IVF-PQ-nl273-m16 (self)                                8_999.39     8_277.72    17_277.11       0.5962          NaN         3.69
IVF-PQ-nl273-m32-np13 (query)                         12_234.32       865.10    13_099.42       0.8462          NaN         5.98
IVF-PQ-nl273-m32-np16 (query)                         12_234.32     1_037.08    13_271.39       0.8463          NaN         5.98
IVF-PQ-nl273-m32-np23 (query)                         12_234.32     1_473.04    13_707.35       0.8463          NaN         5.98
IVF-PQ-nl273-m32 (self)                               12_234.32    14_815.54    27_049.86       0.7928          NaN         5.98
IVF-PQ-nl387-m16-np19 (query)                         10_143.95       647.64    10_791.59       0.7025          NaN         3.75
IVF-PQ-nl387-m16-np27 (query)                         10_143.95       903.22    11_047.17       0.7025          NaN         3.75
IVF-PQ-nl387-m16 (self)                               10_143.95     9_149.11    19_293.06       0.5978          NaN         3.75
IVF-PQ-nl387-m32-np19 (query)                         14_068.57     1_120.98    15_189.55       0.8488          NaN         6.04
IVF-PQ-nl387-m32-np27 (query)                         14_068.57     1_579.21    15_647.78       0.8488          NaN         6.04
IVF-PQ-nl387-m32 (self)                               14_068.57    16_085.61    30_154.18       0.7961          NaN         6.04
IVF-PQ-nl547-m16-np23 (query)                         12_608.40       814.60    13_423.00       0.7074          NaN         3.83
IVF-PQ-nl547-m16-np27 (query)                         12_608.40       909.45    13_517.86       0.7075          NaN         3.83
IVF-PQ-nl547-m16-np33 (query)                         12_608.40     1_079.58    13_687.98       0.7075          NaN         3.83
IVF-PQ-nl547-m16 (self)                               12_608.40    10_579.48    23_187.88       0.5987          NaN         3.83
IVF-PQ-nl547-m32-np23 (query)                         15_007.95     1_270.64    16_278.59       0.8510          NaN         6.12
IVF-PQ-nl547-m32-np27 (query)                         15_007.95     1_480.03    16_487.98       0.8510          NaN         6.12
IVF-PQ-nl547-m32-np33 (query)                         15_007.95     1_778.07    16_786.02       0.8511          NaN         6.12
IVF-PQ-nl547-m32 (self)                               15_007.95    17_882.22    32_890.17       0.7986          NaN         6.12
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

#### With 192 dimensions

This is the area in which these indices start making more sense. With "Gaussian
blob" data, the performance is not too great, but the moment there is more
intrinsic data in the structure, the performance increases.

<details>
<summary><b>PQ quantisations - Euclidean (Gaussian - 192 dim)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 192D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                        21.52     9_919.47     9_940.98       1.0000     0.000000       109.86
Exhaustive (self)                                         21.52   103_699.29   103_720.81       1.0000     0.000000       109.86
--------------------------------------------------------------------------------------------------------------------------------
IVF-PQ-nl273-m16-np13 (query)                         11_988.12       550.50    12_538.62       0.1966          NaN         3.82
IVF-PQ-nl273-m16-np16 (query)                         11_988.12       664.15    12_652.28       0.1971          NaN         3.82
IVF-PQ-nl273-m16-np23 (query)                         11_988.12       930.67    12_918.79       0.1973          NaN         3.82
IVF-PQ-nl273-m16 (self)                               11_988.12     9_276.21    21_264.33       0.1295          NaN         3.82
IVF-PQ-nl273-m32-np13 (query)                         17_401.38     1_152.99    18_554.38       0.3643          NaN         6.11
IVF-PQ-nl273-m32-np16 (query)                         17_401.38     1_455.07    18_856.45       0.3667          NaN         6.11
IVF-PQ-nl273-m32-np23 (query)                         17_401.38     1_967.67    19_369.05       0.3670          NaN         6.11
IVF-PQ-nl273-m32 (self)                               17_401.38    19_325.20    36_726.58       0.2722          NaN         6.11
IVF-PQ-nl273-m48-np13 (query)                         18_603.87     1_380.82    19_984.69       0.5262          NaN         8.40
IVF-PQ-nl273-m48-np16 (query)                         18_603.87     1_700.58    20_304.45       0.5308          NaN         8.40
IVF-PQ-nl273-m48-np23 (query)                         18_603.87     2_372.95    20_976.82       0.5318          NaN         8.40
IVF-PQ-nl273-m48 (self)                               18_603.87    23_740.24    42_344.11       0.4458          NaN         8.40
IVF-PQ-nl387-m16-np19 (query)                         13_951.49       755.81    14_707.30       0.1972          NaN         3.91
IVF-PQ-nl387-m16-np27 (query)                         13_951.49     1_041.83    14_993.32       0.1979          NaN         3.91
IVF-PQ-nl387-m16 (self)                               13_951.49    10_233.81    24_185.30       0.1299          NaN         3.91
IVF-PQ-nl387-m32-np19 (query)                         19_341.13     1_461.50    20_802.63       0.3646          NaN         6.20
IVF-PQ-nl387-m32-np27 (query)                         19_341.13     2_032.66    21_373.79       0.3670          NaN         6.20
IVF-PQ-nl387-m32 (self)                               19_341.13    20_257.92    39_599.04       0.2719          NaN         6.20
IVF-PQ-nl387-m48-np19 (query)                         20_171.18     1_786.31    21_957.49       0.5282          NaN         8.49
IVF-PQ-nl387-m48-np27 (query)                         20_171.18     2_526.22    22_697.40       0.5328          NaN         8.49
IVF-PQ-nl387-m48 (self)                               20_171.18    25_270.84    45_442.03       0.4458          NaN         8.49
IVF-PQ-nl547-m16-np23 (query)                         16_979.20       893.12    17_872.32       0.1988          NaN         4.03
IVF-PQ-nl547-m16-np27 (query)                         16_979.20     1_005.49    17_984.69       0.1996          NaN         4.03
IVF-PQ-nl547-m16-np33 (query)                         16_979.20     1_200.55    18_179.75       0.1998          NaN         4.03
IVF-PQ-nl547-m16 (self)                               16_979.20    12_081.04    29_060.24       0.1308          NaN         4.03
IVF-PQ-nl547-m32-np23 (query)                         21_788.15     1_699.27    23_487.42       0.3627          NaN         6.32
IVF-PQ-nl547-m32-np27 (query)                         21_788.15     2_034.12    23_822.27       0.3651          NaN         6.32
IVF-PQ-nl547-m32-np33 (query)                         21_788.15     2_379.11    24_167.25       0.3661          NaN         6.32
IVF-PQ-nl547-m32 (self)                               21_788.15    23_490.92    45_279.07       0.2735          NaN         6.32
IVF-PQ-nl547-m48-np23 (query)                         22_795.04     1_994.98    24_790.02       0.5277          NaN         8.60
IVF-PQ-nl547-m48-np27 (query)                         22_795.04     2_359.58    25_154.62       0.5334          NaN         8.60
IVF-PQ-nl547-m48-np33 (query)                         22_795.04     2_819.02    25_614.06       0.5354          NaN         8.60
IVF-PQ-nl547-m48 (self)                               22_795.04    27_986.93    50_781.97       0.4486          NaN         8.60
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

---

<details>
<summary><b>PQ quantisations - Euclidean (Correlated - 192 dim)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 192D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                        21.42     9_793.30     9_814.72       1.0000     0.000000       109.86
Exhaustive (self)                                         21.42   108_789.47   108_810.88       1.0000     0.000000       109.86
--------------------------------------------------------------------------------------------------------------------------------
IVF-PQ-nl273-m16-np13 (query)                         12_291.10       595.92    12_887.02       0.4555          NaN         3.82
IVF-PQ-nl273-m16-np16 (query)                         12_291.10       715.83    13_006.93       0.4560          NaN         3.82
IVF-PQ-nl273-m16-np23 (query)                         12_291.10       956.64    13_247.74       0.4560          NaN         3.82
IVF-PQ-nl273-m16 (self)                               12_291.10     9_489.78    21_780.88       0.3551          NaN         3.82
IVF-PQ-nl273-m32-np13 (query)                         17_425.50     1_065.01    18_490.52       0.6328          NaN         6.11
IVF-PQ-nl273-m32-np16 (query)                         17_425.50     1_292.02    18_717.52       0.6339          NaN         6.11
IVF-PQ-nl273-m32-np23 (query)                         17_425.50     1_845.21    19_270.71       0.6341          NaN         6.11
IVF-PQ-nl273-m32 (self)                               17_425.50    18_337.04    35_762.55       0.5494          NaN         6.11
IVF-PQ-nl273-m48-np13 (query)                         19_850.79     1_547.39    21_398.18       0.7322          NaN         8.40
IVF-PQ-nl273-m48-np16 (query)                         19_850.79     1_814.34    21_665.13       0.7340          NaN         8.40
IVF-PQ-nl273-m48-np23 (query)                         19_850.79     2_343.58    22_194.38       0.7343          NaN         8.40
IVF-PQ-nl273-m48 (self)                               19_850.79    25_018.46    44_869.25       0.6706          NaN         8.40
IVF-PQ-nl387-m16-np19 (query)                         13_872.93       745.11    14_618.03       0.4576          NaN         3.91
IVF-PQ-nl387-m16-np27 (query)                         13_872.93     1_017.49    14_890.42       0.4578          NaN         3.91
IVF-PQ-nl387-m16 (self)                               13_872.93    10_215.97    24_088.90       0.3587          NaN         3.91
IVF-PQ-nl387-m32-np19 (query)                         19_232.99     1_438.23    20_671.21       0.6341          NaN         6.20
IVF-PQ-nl387-m32-np27 (query)                         19_232.99     1_986.60    21_219.59       0.6348          NaN         6.20
IVF-PQ-nl387-m32 (self)                               19_232.99    19_998.90    39_231.89       0.5519          NaN         6.20
IVF-PQ-nl387-m48-np19 (query)                         20_747.63     1_747.75    22_495.38       0.7338          NaN         8.49
IVF-PQ-nl387-m48-np27 (query)                         20_747.63     2_441.84    23_189.47       0.7347          NaN         8.49
IVF-PQ-nl387-m48 (self)                               20_747.63    24_546.70    45_294.33       0.6718          NaN         8.49
IVF-PQ-nl547-m16-np23 (query)                         16_462.67       919.43    17_382.10       0.4612          NaN         4.03
IVF-PQ-nl547-m16-np27 (query)                         16_462.67     1_042.60    17_505.27       0.4615          NaN         4.03
IVF-PQ-nl547-m16-np33 (query)                         16_462.67     1_231.42    17_694.09       0.4615          NaN         4.03
IVF-PQ-nl547-m16 (self)                               16_462.67    12_262.91    28_725.58       0.3604          NaN         4.03
IVF-PQ-nl547-m32-np23 (query)                         21_748.13     1_674.06    23_422.19       0.6350          NaN         6.32
IVF-PQ-nl547-m32-np27 (query)                         21_748.13     1_929.30    23_677.43       0.6360          NaN         6.32
IVF-PQ-nl547-m32-np33 (query)                         21_748.13     2_355.27    24_103.39       0.6362          NaN         6.32
IVF-PQ-nl547-m32 (self)                               21_748.13    23_477.94    45_226.07       0.5533          NaN         6.32
IVF-PQ-nl547-m48-np23 (query)                         22_768.47     1_987.40    24_755.87       0.7339          NaN         8.60
IVF-PQ-nl547-m48-np27 (query)                         22_768.47     2_327.67    25_096.14       0.7352          NaN         8.60
IVF-PQ-nl547-m48-np33 (query)                         22_768.47     2_798.11    25_566.57       0.7356          NaN         8.60
IVF-PQ-nl547-m48 (self)                               22_768.47    29_667.67    52_436.14       0.6728          NaN         8.60
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

---

<details>
<summary><b>PQ quantisations - Euclidean (Low Rank - 192 dim)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 192D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                        22.38     9_798.32     9_820.70       1.0000     0.000000       109.86
Exhaustive (self)                                         22.38    99_166.38    99_188.76       1.0000     0.000000       109.86
--------------------------------------------------------------------------------------------------------------------------------
IVF-PQ-nl273-m16-np13 (query)                         13_040.56       645.25    13_685.81       0.6642          NaN         3.82
IVF-PQ-nl273-m16-np16 (query)                         13_040.56       716.12    13_756.69       0.6642          NaN         3.82
IVF-PQ-nl273-m16-np23 (query)                         13_040.56     1_019.92    14_060.48       0.6642          NaN         3.82
IVF-PQ-nl273-m16 (self)                               13_040.56    10_117.37    23_157.93       0.5399          NaN         3.82
IVF-PQ-nl273-m32-np13 (query)                         17_739.32     1_136.42    18_875.75       0.7979          NaN         6.11
IVF-PQ-nl273-m32-np16 (query)                         17_739.32     1_395.32    19_134.65       0.7980          NaN         6.11
IVF-PQ-nl273-m32-np23 (query)                         17_739.32     1_920.72    19_660.05       0.7980          NaN         6.11
IVF-PQ-nl273-m32 (self)                               17_739.32    19_299.15    37_038.47       0.7264          NaN         6.11
IVF-PQ-nl273-m48-np13 (query)                         18_391.02     1_372.76    19_763.78       0.8724          NaN         8.40
IVF-PQ-nl273-m48-np16 (query)                         18_391.02     1_676.81    20_067.84       0.8725          NaN         8.40
IVF-PQ-nl273-m48-np23 (query)                         18_391.02     2_373.32    20_764.34       0.8725          NaN         8.40
IVF-PQ-nl273-m48 (self)                               18_391.02    23_607.84    41_998.86       0.8280          NaN         8.40
IVF-PQ-nl387-m16-np19 (query)                         13_950.70       754.73    14_705.43       0.6668          NaN         3.91
IVF-PQ-nl387-m16-np27 (query)                         13_950.70     1_037.99    14_988.69       0.6668          NaN         3.91
IVF-PQ-nl387-m16 (self)                               13_950.70    10_500.12    24_450.82       0.5355          NaN         3.91
IVF-PQ-nl387-m32-np19 (query)                         19_329.47     1_462.82    20_792.29       0.7990          NaN         6.20
IVF-PQ-nl387-m32-np27 (query)                         19_329.47     2_026.09    21_355.56       0.7990          NaN         6.20
IVF-PQ-nl387-m32 (self)                               19_329.47    20_350.53    39_680.00       0.7264          NaN         6.20
IVF-PQ-nl387-m48-np19 (query)                         20_186.36     1_769.72    21_956.08       0.8741          NaN         8.49
IVF-PQ-nl387-m48-np27 (query)                         20_186.36     2_483.81    22_670.17       0.8741          NaN         8.49
IVF-PQ-nl387-m48 (self)                               20_186.36    24_829.99    45_016.35       0.8298          NaN         8.49
IVF-PQ-nl547-m16-np23 (query)                         16_335.17       871.33    17_206.49       0.6691          NaN         4.03
IVF-PQ-nl547-m16-np27 (query)                         16_335.17       995.42    17_330.58       0.6692          NaN         4.03
IVF-PQ-nl547-m16-np33 (query)                         16_335.17     1_197.05    17_532.22       0.6692          NaN         4.03
IVF-PQ-nl547-m16 (self)                               16_335.17    12_973.75    29_308.92       0.5313          NaN         4.03
IVF-PQ-nl547-m32-np23 (query)                         21_704.67     1_654.07    23_358.74       0.8013          NaN         6.32
IVF-PQ-nl547-m32-np27 (query)                         21_704.67     1_928.10    23_632.77       0.8013          NaN         6.32
IVF-PQ-nl547-m32-np33 (query)                         21_704.67     2_315.16    24_019.82       0.8013          NaN         6.32
IVF-PQ-nl547-m32 (self)                               21_704.67    23_461.42    45_166.09       0.7266          NaN         6.32
IVF-PQ-nl547-m48-np23 (query)                         24_106.46     1_999.77    26_106.23       0.8750          NaN         8.60
IVF-PQ-nl547-m48-np27 (query)                         24_106.46     2_313.80    26_420.26       0.8751          NaN         8.60
IVF-PQ-nl547-m48-np33 (query)                         24_106.46     2_807.68    26_914.14       0.8751          NaN         8.60
IVF-PQ-nl547-m48 (self)                               24_106.46    27_885.50    51_991.96       0.8316          NaN         8.60
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

### Optimised product quantisation (IVF only)

This index uses optimised product quantisation - this substantially increases
the build time. Similar to IVF-PQ, the quantisation is quite harsh and hence,
reduces the recall quite substantially compared to exhaustive search. Each
vector gets reduced to from *192 x 32 bits (192 x f32) = 768 bytes* to for
*m = 32 (32 sub vectors) to 32 x u8 = 32 bytes*, a
**24x reduction in memory usage** (of course with overhead from the cook book).
However, it can still be useful in situation where good enough works and you
have VERY large scale data. The theoretical benefits at least in this
synthetic data do not translate very well. IVF-PQ is usually more than enough,
outside of cases in which a specific correlation structure can be exploited
by the optimised PQ. If in doubt, use the IVF-PQ index.

**Key parameters:**

- *Number of lists (nl)*: The number of independent k-means cluster to generate.
  If the structure of the data is unknown, people use `sqrt(n)` as a heuristic.
- *Number of points (np)*: The number of clusters to probe during search.
  Numbers here tend to be `sqrt(nlist)` or up to 5% of the nlist.
- *Number of subvectors (m)*: In how many subvectors to divide the given main
  vector. The initial dimensionality needs to be divisable by m.

Similar to IVF-OP, the self kNN generation is run on the compressed indices,
with the same loss of Recall due to the severe compression. Again, similar to
`IVF-SQ8` the distances are difficult to interpret/compare against original
vectors due to the heavy quantisation (plus rotation), thus, are not reported.

#### With 128 dimensions

Due to being optimised for high dimensional data, we start with 128 dimensions
here. One can appreciate that `m16` causes a high Recall loss as it compresses
the data too much and the more "structure" the data has (correlated features,
low rank manifolds), the better these indices perform. The PQ quantisation
however is a bit more expensive, hence, more time is being used on index
building. Querying on the other hand is very performant.

<details>
<summary><b>OPQ quantisations - Euclidean (Gaussian - 128 dim)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 128D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                        15.20     6_211.43     6_226.63       1.0000     0.000000        73.24
Exhaustive (self)                                         15.20    63_337.96    63_353.16       1.0000     0.000000        73.24
--------------------------------------------------------------------------------------------------------------------------------
IVF-OPQ-nl273-m16-np13 (query)                        18_241.28       550.14    18_791.41       0.2673          NaN         3.76
IVF-OPQ-nl273-m16-np16 (query)                        18_241.28       645.38    18_886.65       0.2693          NaN         3.76
IVF-OPQ-nl273-m16-np23 (query)                        18_241.28       915.23    19_156.50       0.2702          NaN         3.76
IVF-OPQ-nl273-m16 (self)                              18_241.28     9_746.94    27_988.22       0.1807          NaN         3.76
IVF-OPQ-nl273-m32-np13 (query)                        26_951.46       951.97    27_903.43       0.5093          NaN         6.05
IVF-OPQ-nl273-m32-np16 (query)                        26_951.46     1_100.12    28_051.58       0.5167          NaN         6.05
IVF-OPQ-nl273-m32-np23 (query)                        26_951.46     1_495.73    28_447.18       0.5213          NaN         6.05
IVF-OPQ-nl273-m32 (self)                              26_951.46    15_275.71    42_227.17       0.4286          NaN         6.05
IVF-OPQ-nl387-m16-np19 (query)                        19_333.74       647.15    19_980.89       0.2694          NaN         3.81
IVF-OPQ-nl387-m16-np27 (query)                        19_333.74       894.58    20_228.32       0.2712          NaN         3.81
IVF-OPQ-nl387-m16 (self)                              19_333.74     9_333.73    28_667.48       0.1818          NaN         3.81
IVF-OPQ-nl387-m32-np19 (query)                        27_320.93     1_109.77    28_430.70       0.5139          NaN         6.10
IVF-OPQ-nl387-m32-np27 (query)                        27_320.93     1_552.18    28_873.12       0.5213          NaN         6.10
IVF-OPQ-nl387-m32 (self)                              27_320.93    15_743.14    43_064.08       0.4284          NaN         6.10
IVF-OPQ-nl547-m16-np23 (query)                        20_322.61       781.91    21_104.52       0.2707          NaN         3.89
IVF-OPQ-nl547-m16-np27 (query)                        20_322.61       901.34    21_223.95       0.2721          NaN         3.89
IVF-OPQ-nl547-m16-np33 (query)                        20_322.61     1_091.15    21_413.76       0.2731          NaN         3.89
IVF-OPQ-nl547-m16 (self)                              20_322.61    11_055.99    31_378.59       0.1835          NaN         3.89
IVF-OPQ-nl547-m32-np23 (query)                        27_903.25     1_263.14    29_166.38       0.5110          NaN         6.18
IVF-OPQ-nl547-m32-np27 (query)                        27_903.25     1_467.85    29_371.10       0.5166          NaN         6.18
IVF-OPQ-nl547-m32-np33 (query)                        27_903.25     1_776.26    29_679.51       0.5208          NaN         6.18
IVF-OPQ-nl547-m32 (self)                              27_903.25    18_173.29    46_076.54       0.4302          NaN         6.18
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

---

<details>
<summary><b>PQ quantisations - Euclidean (Correlated - 128 dim)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 128D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                        15.51     6_128.70     6_144.21       1.0000     0.000000        73.24
Exhaustive (self)                                         15.51    62_510.88    62_526.40       1.0000     0.000000        73.24
--------------------------------------------------------------------------------------------------------------------------------
IVF-OPQ-nl273-m16-np13 (query)                        17_671.11       499.43    18_170.54       0.5572          NaN         3.76
IVF-OPQ-nl273-m16-np16 (query)                        17_671.11       607.71    18_278.82       0.5578          NaN         3.76
IVF-OPQ-nl273-m16-np23 (query)                        17_671.11       852.47    18_523.58       0.5580          NaN         3.76
IVF-OPQ-nl273-m16 (self)                              17_671.11     8_707.23    26_378.34       0.4605          NaN         3.76
IVF-OPQ-nl273-m32-np13 (query)                        26_473.21       872.68    27_345.89       0.7304          NaN         6.05
IVF-OPQ-nl273-m32-np16 (query)                        26_473.21     1_069.10    27_542.31       0.7318          NaN         6.05
IVF-OPQ-nl273-m32-np23 (query)                        26_473.21     1_529.66    28_002.87       0.7323          NaN         6.05
IVF-OPQ-nl273-m32 (self)                              26_473.21    15_329.31    41_802.52       0.6658          NaN         6.05
IVF-OPQ-nl387-m16-np19 (query)                        18_894.03       641.91    19_535.94       0.5573          NaN         3.81
IVF-OPQ-nl387-m16-np27 (query)                        18_894.03       899.60    19_793.63       0.5577          NaN         3.81
IVF-OPQ-nl387-m16 (self)                              18_894.03     9_220.95    28_114.98       0.4626          NaN         3.81
IVF-OPQ-nl387-m32-np19 (query)                        26_298.29     1_137.39    27_435.68       0.7323          NaN         6.10
IVF-OPQ-nl387-m32-np27 (query)                        26_298.29     1_576.64    27_874.93       0.7333          NaN         6.10
IVF-OPQ-nl387-m32 (self)                              26_298.29    17_035.68    43_333.97       0.6667          NaN         6.10
IVF-OPQ-nl547-m16-np23 (query)                        20_496.64       753.05    21_249.69       0.5617          NaN         3.89
IVF-OPQ-nl547-m16-np27 (query)                        20_496.64       867.98    21_364.62       0.5621          NaN         3.89
IVF-OPQ-nl547-m16-np33 (query)                        20_496.64     1_055.59    21_552.23       0.5623          NaN         3.89
IVF-OPQ-nl547-m16 (self)                              20_496.64    10_421.07    30_917.71       0.4656          NaN         3.89
IVF-OPQ-nl547-m32-np23 (query)                        27_939.91     1_274.90    29_214.81       0.7320          NaN         6.18
IVF-OPQ-nl547-m32-np27 (query)                        27_939.91     1_478.53    29_418.44       0.7331          NaN         6.18
IVF-OPQ-nl547-m32-np33 (query)                        27_939.91     1_796.77    29_736.68       0.7338          NaN         6.18
IVF-OPQ-nl547-m32 (self)                              27_939.91    18_318.54    46_258.45       0.6692          NaN         6.18
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

---

<details>
<summary><b>PQ quantisations - Euclidean (Low Rank - 128 dim)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 128D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                        15.39     6_145.44     6_160.83       1.0000     0.000000        73.24
Exhaustive (self)                                         15.39    66_414.24    66_429.63       1.0000     0.000000        73.24
--------------------------------------------------------------------------------------------------------------------------------
IVF-OPQ-nl273-m16-np13 (query)                        18_284.17       481.24    18_765.41       0.7479          NaN         3.76
IVF-OPQ-nl273-m16-np16 (query)                        18_284.17       581.30    18_865.47       0.7479          NaN         3.76
IVF-OPQ-nl273-m16-np23 (query)                        18_284.17       800.50    19_084.67       0.7479          NaN         3.76
IVF-OPQ-nl273-m16 (self)                              18_284.17     8_545.78    26_829.95       0.6740          NaN         3.76
IVF-OPQ-nl273-m32-np13 (query)                        25_395.56       867.47    26_263.03       0.8614          NaN         6.05
IVF-OPQ-nl273-m32-np16 (query)                        25_395.56     1_113.78    26_509.34       0.8615          NaN         6.05
IVF-OPQ-nl273-m32-np23 (query)                        25_395.56     1_468.91    26_864.47       0.8615          NaN         6.05
IVF-OPQ-nl273-m32 (self)                              25_395.56    14_916.70    40_312.27       0.8134          NaN         6.05
IVF-OPQ-nl387-m16-np19 (query)                        18_790.93       647.07    19_438.00       0.7510          NaN         3.81
IVF-OPQ-nl387-m16-np27 (query)                        18_790.93       903.28    19_694.21       0.7510          NaN         3.81
IVF-OPQ-nl387-m16 (self)                              18_790.93     9_204.26    27_995.19       0.6775          NaN         3.81
IVF-OPQ-nl387-m32-np19 (query)                        26_532.42     1_120.27    27_652.68       0.8642          NaN         6.10
IVF-OPQ-nl387-m32-np27 (query)                        26_532.42     1_564.08    28_096.50       0.8642          NaN         6.10
IVF-OPQ-nl387-m32 (self)                              26_532.42    15_826.58    42_359.00       0.8165          NaN         6.10
IVF-OPQ-nl547-m16-np23 (query)                        21_712.95       743.63    22_456.58       0.7515          NaN         3.89
IVF-OPQ-nl547-m16-np27 (query)                        21_712.95       841.29    22_554.24       0.7515          NaN         3.89
IVF-OPQ-nl547-m16-np33 (query)                        21_712.95     1_014.87    22_727.82       0.7515          NaN         3.89
IVF-OPQ-nl547-m16 (self)                              21_712.95    10_402.24    32_115.19       0.6804          NaN         3.89
IVF-OPQ-nl547-m32-np23 (query)                        28_155.33     1_248.53    29_403.86       0.8664          NaN         6.18
IVF-OPQ-nl547-m32-np27 (query)                        28_155.33     1_459.39    29_614.72       0.8664          NaN         6.18
IVF-OPQ-nl547-m32-np33 (query)                        28_155.33     1_756.71    29_912.04       0.8664          NaN         6.18
IVF-OPQ-nl547-m32 (self)                              28_155.33    17_753.59    45_908.92       0.8190          NaN         6.18
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

#### With 192 dimensions

This is the area in which these indices start making more sense. With "Gaussian
blob" data, the performance is not too great, but the moment there is more
intrinsic data in the structure, the performance increases.

<details>
<summary><b>PQ quantisations - Euclidean (Gaussian - 192 dim)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 192D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                        22.26     9_635.47     9_657.73       1.0000     0.000000       109.86
Exhaustive (self)                                         22.26   101_087.65   101_109.90       1.0000     0.000000       109.86
--------------------------------------------------------------------------------------------------------------------------------
IVF-OPQ-nl273-m16-np13 (query)                        29_898.51       590.24    30_488.75       0.1967          NaN         3.96
IVF-OPQ-nl273-m16-np16 (query)                        29_898.51       705.11    30_603.62       0.1973          NaN         3.96
IVF-OPQ-nl273-m16-np23 (query)                        29_898.51       971.70    30_870.21       0.1974          NaN         3.96
IVF-OPQ-nl273-m16 (self)                              29_898.51    10_343.44    40_241.95       0.1289          NaN         3.96
IVF-OPQ-nl273-m32-np13 (query)                        39_159.11     1_107.65    40_266.76       0.3619          NaN         6.25
IVF-OPQ-nl273-m32-np16 (query)                        39_159.11     1_335.99    40_495.10       0.3642          NaN         6.25
IVF-OPQ-nl273-m32-np23 (query)                        39_159.11     1_894.30    41_053.41       0.3647          NaN         6.25
IVF-OPQ-nl273-m32 (self)                              39_159.11    19_476.73    58_635.84       0.2713          NaN         6.25
IVF-OPQ-nl273-m48-np13 (query)                        42_054.10     1_460.07    43_514.17       0.5264          NaN         8.54
IVF-OPQ-nl273-m48-np16 (query)                        42_054.10     1_739.98    43_794.08       0.5312          NaN         8.54
IVF-OPQ-nl273-m48-np23 (query)                        42_054.10     2_522.98    44_577.08       0.5322          NaN         8.54
IVF-OPQ-nl273-m48 (self)                              42_054.10    25_281.81    67_335.91       0.4455          NaN         8.54
IVF-OPQ-nl387-m16-np19 (query)                        28_550.68       805.39    29_356.07       0.1981          NaN         4.05
IVF-OPQ-nl387-m16-np27 (query)                        28_550.68     1_115.49    29_666.17       0.1985          NaN         4.05
IVF-OPQ-nl387-m16 (self)                              28_550.68    11_557.81    40_108.49       0.1298          NaN         4.05
IVF-OPQ-nl387-m32-np19 (query)                        39_490.42     1_474.46    40_964.88       0.3630          NaN         6.34
IVF-OPQ-nl387-m32-np27 (query)                        39_490.42     2_061.61    41_552.04       0.3652          NaN         6.34
IVF-OPQ-nl387-m32 (self)                              39_490.42    21_190.39    60_680.82       0.2708          NaN         6.34
IVF-OPQ-nl387-m48-np19 (query)                        42_720.01     1_969.89    44_689.90       0.5287          NaN         8.63
IVF-OPQ-nl387-m48-np27 (query)                        42_720.01     2_840.45    45_560.46       0.5336          NaN         8.63
IVF-OPQ-nl387-m48 (self)                              42_720.01    25_637.58    68_357.59       0.4472          NaN         8.63
IVF-OPQ-nl547-m16-np23 (query)                        29_210.21       885.30    30_095.51       0.1969          NaN         4.17
IVF-OPQ-nl547-m16-np27 (query)                        29_210.21     1_033.40    30_243.61       0.1976          NaN         4.17
IVF-OPQ-nl547-m16-np33 (query)                        29_210.21     1_214.71    30_424.92       0.1979          NaN         4.17
IVF-OPQ-nl547-m16 (self)                              29_210.21    13_549.96    42_760.17       0.1300          NaN         4.17
IVF-OPQ-nl547-m32-np23 (query)                        39_706.94     1_672.28    41_379.22       0.3641          NaN         6.46
IVF-OPQ-nl547-m32-np27 (query)                        39_706.94     1_930.25    41_637.18       0.3666          NaN         6.46
IVF-OPQ-nl547-m32-np33 (query)                        39_706.94     2_332.06    42_038.99       0.3677          NaN         6.46
IVF-OPQ-nl547-m32 (self)                              39_706.94    23_905.76    63_612.70       0.2739          NaN         6.46
IVF-OPQ-nl547-m48-np23 (query)                        42_291.84     1_986.71    44_278.55       0.5274          NaN         8.75
IVF-OPQ-nl547-m48-np27 (query)                        42_291.84     2_320.52    44_612.36       0.5332          NaN         8.75
IVF-OPQ-nl547-m48-np33 (query)                        42_291.84     2_786.65    45_078.49       0.5353          NaN         8.75
IVF-OPQ-nl547-m48 (self)                              42_291.84    30_645.11    72_936.96       0.4479          NaN         8.75
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

---

<details>
<summary><b>PQ quantisations - Euclidean (Correlated - 192 dim)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 192D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                        22.94     9_765.40     9_788.35       1.0000     0.000000       109.86
Exhaustive (self)                                         22.94    97_933.86    97_956.81       1.0000     0.000000       109.86
--------------------------------------------------------------------------------------------------------------------------------
IVF-OPQ-nl273-m16-np13 (query)                        24_911.30       559.66    25_470.96       0.4612          NaN         3.96
IVF-OPQ-nl273-m16-np16 (query)                        24_911.30       666.81    25_578.11       0.4617          NaN         3.96
IVF-OPQ-nl273-m16-np23 (query)                        24_911.30       940.60    25_851.89       0.4618          NaN         3.96
IVF-OPQ-nl273-m16 (self)                              24_911.30    10_537.10    35_448.40       0.3653          NaN         3.96
IVF-OPQ-nl273-m32-np13 (query)                        36_511.24     1_055.35    37_566.59       0.6347          NaN         6.25
IVF-OPQ-nl273-m32-np16 (query)                        36_511.24     1_285.34    37_796.58       0.6359          NaN         6.25
IVF-OPQ-nl273-m32-np23 (query)                        36_511.24     1_838.11    38_349.35       0.6360          NaN         6.25
IVF-OPQ-nl273-m32 (self)                              36_511.24    20_229.10    56_740.34       0.5541          NaN         6.25
IVF-OPQ-nl273-m48-np13 (query)                        37_734.20     1_382.96    39_117.16       0.7347          NaN         8.54
IVF-OPQ-nl273-m48-np16 (query)                        37_734.20     1_736.19    39_470.39       0.7364          NaN         8.54
IVF-OPQ-nl273-m48-np23 (query)                        37_734.20     2_422.48    40_156.68       0.7367          NaN         8.54
IVF-OPQ-nl273-m48 (self)                              37_734.20    24_264.85    61_999.05       0.6757          NaN         8.54
IVF-OPQ-nl387-m16-np19 (query)                        29_287.17       755.35    30_042.51       0.4636          NaN         4.05
IVF-OPQ-nl387-m16-np27 (query)                        29_287.17     1_029.02    30_316.18       0.4637          NaN         4.05
IVF-OPQ-nl387-m16 (self)                              29_287.17    10_942.85    40_230.01       0.3674          NaN         4.05
IVF-OPQ-nl387-m32-np19 (query)                        41_916.38     1_665.80    43_582.19       0.6371          NaN         6.34
IVF-OPQ-nl387-m32-np27 (query)                        41_916.38     2_253.42    44_169.80       0.6377          NaN         6.34
IVF-OPQ-nl387-m32 (self)                              41_916.38    21_937.29    63_853.67       0.5570          NaN         6.34
IVF-OPQ-nl387-m48-np19 (query)                        40_759.22     1_754.90    42_514.11       0.7354          NaN         8.63
IVF-OPQ-nl387-m48-np27 (query)                        40_759.22     2_448.65    43_207.87       0.7364          NaN         8.63
IVF-OPQ-nl387-m48 (self)                              40_759.22    25_089.52    65_848.73       0.6772          NaN         8.63
IVF-OPQ-nl547-m16-np23 (query)                        29_539.32       863.90    30_403.22       0.4657          NaN         4.17
IVF-OPQ-nl547-m16-np27 (query)                        29_539.32     1_020.47    30_559.79       0.4660          NaN         4.17
IVF-OPQ-nl547-m16-np33 (query)                        29_539.32     1_207.48    30_746.80       0.4660          NaN         4.17
IVF-OPQ-nl547-m16 (self)                              29_539.32    12_487.77    42_027.09       0.3699          NaN         4.17
IVF-OPQ-nl547-m32-np23 (query)                        39_538.70     1_672.23    41_210.93       0.6383          NaN         6.46
IVF-OPQ-nl547-m32-np27 (query)                        39_538.70     1_939.03    41_477.73       0.6390          NaN         6.46
IVF-OPQ-nl547-m32-np33 (query)                        39_538.70     2_377.56    41_916.27       0.6393          NaN         6.46
IVF-OPQ-nl547-m32 (self)                              39_538.70    24_314.44    63_853.15       0.5588          NaN         6.46
IVF-OPQ-nl547-m48-np23 (query)                        42_030.84     1_973.75    44_004.59       0.7379          NaN         8.75
IVF-OPQ-nl547-m48-np27 (query)                        42_030.84     2_346.65    44_377.49       0.7395          NaN         8.75
IVF-OPQ-nl547-m48-np33 (query)                        42_030.84     2_755.08    44_785.92       0.7400          NaN         8.75
IVF-OPQ-nl547-m48 (self)                              42_030.84    28_536.94    70_567.77       0.6783          NaN         8.75
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

---

<details>
<summary><b>PQ quantisations - Euclidean (Low Rank - 192 dim)</b>:</summary>
<pre><code>
================================================================================================================================
Benchmark: 150k cells, 192D
================================================================================================================================
Method                                               Build (ms)   Query (ms)   Total (ms)     Recall@k   Dist Error    Size (MB)
--------------------------------------------------------------------------------------------------------------------------------
Exhaustive (query)                                        22.08     9_728.26     9_750.34       1.0000     0.000000       109.86
Exhaustive (self)                                         22.08    98_911.52    98_933.60       1.0000     0.000000       109.86
--------------------------------------------------------------------------------------------------------------------------------
IVF-OPQ-nl273-m16-np13 (query)                        25_108.52       550.38    25_658.90       0.7191          NaN         3.96
IVF-OPQ-nl273-m16-np16 (query)                        25_108.52       659.00    25_767.51       0.7191          NaN         3.96
IVF-OPQ-nl273-m16-np23 (query)                        25_108.52       929.84    26_038.35       0.7191          NaN         3.96
IVF-OPQ-nl273-m16 (self)                              25_108.52     9_770.54    34_879.05       0.6407          NaN         3.96
IVF-OPQ-nl273-m32-np13 (query)                        35_179.86     1_088.13    36_268.00       0.8300          NaN         6.25
IVF-OPQ-nl273-m32-np16 (query)                        35_179.86     1_319.05    36_498.91       0.8300          NaN         6.25
IVF-OPQ-nl273-m32-np23 (query)                        35_179.86     1_863.76    37_043.62       0.8300          NaN         6.25
IVF-OPQ-nl273-m32 (self)                              35_179.86    19_239.38    54_419.24       0.7725          NaN         6.25
IVF-OPQ-nl273-m48-np13 (query)                        37_472.20     1_378.98    38_851.18       0.8878          NaN         8.54
IVF-OPQ-nl273-m48-np16 (query)                        37_472.20     1_667.81    39_140.01       0.8879          NaN         8.54
IVF-OPQ-nl273-m48-np23 (query)                        37_472.20     2_377.49    39_849.69       0.8879          NaN         8.54
IVF-OPQ-nl273-m48 (self)                              37_472.20    24_166.36    61_638.56       0.8453          NaN         8.54
IVF-OPQ-nl387-m16-np19 (query)                        26_409.61       752.71    27_162.32       0.7214          NaN         4.05
IVF-OPQ-nl387-m16-np27 (query)                        26_409.61     1_042.50    27_452.11       0.7214          NaN         4.05
IVF-OPQ-nl387-m16 (self)                              26_409.61    10_869.58    37_279.18       0.6411          NaN         4.05
IVF-OPQ-nl387-m32-np19 (query)                        41_982.67     1_480.16    43_462.83       0.8302          NaN         6.34
IVF-OPQ-nl387-m32-np27 (query)                        41_982.67     2_052.76    44_035.43       0.8302          NaN         6.34
IVF-OPQ-nl387-m32 (self)                              41_982.67    21_055.16    63_037.84       0.7746          NaN         6.34
IVF-OPQ-nl387-m48-np19 (query)                        48_629.39     1_790.88    50_420.27       0.8883          NaN         8.63
IVF-OPQ-nl387-m48-np27 (query)                        48_629.39     2_507.58    51_136.97       0.8883          NaN         8.63
IVF-OPQ-nl387-m48 (self)                              48_629.39    25_942.15    74_571.54       0.8471          NaN         8.63
IVF-OPQ-nl547-m16-np23 (query)                        32_225.15       954.18    33_179.32       0.7218          NaN         4.17
IVF-OPQ-nl547-m16-np27 (query)                        32_225.15     1_073.50    33_298.64       0.7218          NaN         4.17
IVF-OPQ-nl547-m16-np33 (query)                        32_225.15     1_285.05    33_510.19       0.7218          NaN         4.17
IVF-OPQ-nl547-m16 (self)                              32_225.15    13_288.81    45_513.96       0.6460          NaN         4.17
IVF-OPQ-nl547-m32-np23 (query)                        39_681.40     1_683.50    41_364.90       0.8306          NaN         6.46
IVF-OPQ-nl547-m32-np27 (query)                        39_681.40     1_920.61    41_602.01       0.8306          NaN         6.46
IVF-OPQ-nl547-m32-np33 (query)                        39_681.40     2_333.60    42_015.00       0.8306          NaN         6.46
IVF-OPQ-nl547-m32 (self)                              39_681.40    23_881.48    63_562.88       0.7759          NaN         6.46
IVF-OPQ-nl547-m48-np23 (query)                        41_787.23     1_965.80    43_753.03       0.8892          NaN         8.75
IVF-OPQ-nl547-m48-np27 (query)                        41_787.23     2_294.51    44_081.74       0.8892          NaN         8.75
IVF-OPQ-nl547-m48-np33 (query)                        41_787.23     2_759.38    44_546.61       0.8892          NaN         8.75
IVF-OPQ-nl547-m48 (self)                              41_787.23    28_507.08    70_294.31       0.8485          NaN         8.75
--------------------------------------------------------------------------------------------------------------------------------
</code></pre>
</details>

*All benchmarks were run on M1 Max MacBook Pro with 64 GB unified memory.*
